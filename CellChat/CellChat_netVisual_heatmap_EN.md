# Caveat: `netVisual_heatmap()` Does **Not** Subset by Signaling Pathway

This note documents an important and non-obvious behavior of **CellChat `netVisual_heatmap()`** when used in comparative analyses.

---
  
  ## ⚠️ Key Warning
  
  > **`netVisual_heatmap()` does NOT support pathway-specific subsetting via the `signaling` argument.**
  
  Even if `signaling` is explicitly specified, the resulting heatmap still reflects **global (aggregate) signaling across all pathways**, rather than the selected pathway.

This behavior can easily lead to **incorrect interpretation** if the output is assumed to be pathway-specific.

---
  
  ## Example of a Potentially Misleading Usage
  
  ```r
# Intended: SEMA3-specific sender → receiver differences (Keloid - Normal Skin)
p_heat_weight <- netVisual_heatmap(
  cellchat_merged,
  signaling  = SIGNALING_USE,      # e.g., "SEMA3"
  comparison = comparison_use,
  measure    = "weight"
) + ggtitle(paste0(SIGNALING_USE, " heatmap weight (Keloid - Normal Skin)"))

p_heat_count <- netVisual_heatmap(
  cellchat_merged,
  signaling  = SIGNALING_USE,
  comparison = comparison_use,
  measure    = "count"
) + ggtitle(paste0(SIGNALING_USE, " heatmap count (Keloid - Normal Skin)"))
```

### ⚠️ Critical Issue

Despite setting `signaling = "SEMA3"`, both heatmaps above **still represent the overall signaling network**, aggregated across *all* pathways.

The titles suggest pathway-specific results, but **the underlying data are not pathway-filtered**.

---
  
  ## What `netVisual_heatmap()` Actually Computes
  
  When `comparison` is specified, `netVisual_heatmap()`:
  
  * Aggregates communication probabilities across **all signaling pathways**
  * Computes differences between conditions (e.g., Keloid − Normal Skin)
* Visualizes sender → receiver interaction strength using:
  
  * `measure = "weight"` (sum of communication probabilities), or
* `measure = "count"` (number of significant interactions)

The `signaling` argument is **currently ignored** in the internal data aggregation step for this function.

---
  
  ## Why This Matters
  
  If the heatmap is interpreted as pathway-specific (e.g., *SEMA3-specific signaling changes*), this can result in:
  
  * Over-attribution of global communication changes to a single pathway
* Incorrect biological conclusions
* Misleading figure titles and captions

This issue is especially problematic in comparative studies where pathway-level interpretation is critical.

---
  
  ## Recommended Practices
  
  ### ✅ If You Want Global Signaling Differences
  
  * `netVisual_heatmap()` is appropriate
* **Do not include pathway names** in figure titles or captions

Example:
  
  > Heatmap of global cell–cell communication differences (Keloid − Normal Skin)

---
  
  ### ❌ If You Want Pathway-Specific Heatmaps
  
  * `netVisual_heatmap()` **should not be used**
  * Subsetting by `signaling` is not supported

Instead, consider:
  
  * Extracting pathway-specific communication data using:
  
  * `subsetCommunication()`
* `netAnalysis_signalingRole_*()` outputs
* Manually constructing a sender–receiver matrix for the selected pathway
* Visualizing the result using `ggplot2::geom_tile()` or similar tools

---
  
  ## Take-home Message
  
  > In CellChat, `netVisual_heatmap()` always visualizes **aggregate signaling across all pathways**. The `signaling` argument does not restrict the analysis to a specific pathway and should not be relied upon for pathway-level interpretation.

---
  
  ## Suggested Citation Note (Optional)
  
  When using or reproducing this analysis, consider explicitly stating:
  
  > Heatmaps generated by `netVisual_heatmap()` represent global cell–cell communication differences and are not pathway-specific, regardless of the `signaling` argument.

---
## Package versions at the time of writing

- R: 4.4.1
- OS: Windows 10 x64 (build 19045)
- CellChat: 2.1.2
- Seurat: 5.3.0
- ggplot2: 3.5.1
- Time zone: Asia/Taipei
